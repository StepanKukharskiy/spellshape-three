<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spellshape Three Dev</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container { 
            flex: 1;
            width: 100%;
            display: flex;
        }
        canvas { 
            display: block; 
            flex: 1;
            width: 100%;
            height: 100%;
        }
        .controls{
            z-index: 2;
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <canvas id="canvas"></canvas>
        
        <div class="controls">
            <div class="control-item">
                <label>Width (0.1 - 5.0m)</label>
                <input type="range" id="cube_width" min="0.1" max="5" step="0.01" value="3">
                <span class="value-display" id="width_display">1.00m</span>
            </div>
        </div>
    </div>
    
    <div id="validation-panel" style="position: absolute; top: 10px; left: 10px; background: rgba(255,0,0,0.8); color: white; padding: 10px; display: none;"></div>
    <script type="module">
        import { start } from './src/index.js';
        
        // Example schema for testing
        const testSchema = {
  "version": "3.1",
  "type": "parametric_scene",
  "children": [
    {
      "type": "parametric_template",
      "id": "cube",
      "parameters": {
        "cube_width": {
          "value": 1,
          "type": "number",
          "min": 0.1,
          "max": 5,
          "step": 0.01,
          "group": "geometry"
        }
      },
      "expressions": {},
      "constraints": {},
      "template": [
        {
          "type": "box",
          "id": "main_cube",
          "material": "cube_material",
          "dimensions": [
            "$cube_width",
            "$cube_width",
            "$cube_width"
          ],
          "position": [0, 0.5, 0]
        }
      ]
    }
  ],
  "materials": {
    "cube_material": {
      "type": "standard",
      "color": "#2196f3",
      "roughness": 0.4,
      "metalness": 0.1
    }
  },
  "ui_controls": {
    "groups": {
      "geometry": {
        "label": "ðŸ”· Geometry",
        "order": 1,
        "default_open": true
      }
    }
  }
}

       // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', async () => {
            const canvas = document.getElementById('canvas');
            let viewer = null;
            
            // Initialize the viewer
            async function initViewer() {
                try {
                    viewer = await start(canvas, testSchema, false);
                    console.log('Viewer initialized:', viewer);
                    
                    // Check if updateParameter is available
                    if (viewer.updateParameter) {
                        console.log('âœ… updateParameter function is available');
                    } else {
                        console.error('âŒ updateParameter function is NOT available');
                    }
                } catch (error) {
                    console.error('Error initializing viewer:', error);
                }
            }
            
            // Setup the single control
            function setupControl() {
                const heightInput = document.getElementById('cube_width');
                const heightDisplay = document.getElementById('width_display');
                
                // Check if elements exist
                if (!heightInput) {
                    console.error('Height input element not found!');
                    return;
                }
                if (!heightDisplay) {
                    console.error('Height display element not found!');
                    return;
                }
                
                console.log('âœ… Control elements found, setting up event listener');
                
                heightInput.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    
                    // Update the 3D model using selective regeneration
                    if (viewer && viewer.updateParameter) {
                        const success = viewer.updateParameter('cube_width', value);
                        console.log(`Updated cube_width to ${value}: ${success ? 'Success' : 'Failed'}`);
                    } else {
                        console.error('updateParameter function not available');
                    }
                    
                    // Update the display
                    heightDisplay.textContent = value.toFixed(2) + 'm';
                });
                
                console.log('âœ… Event listener attached successfully');
            }
            
            // Initialize everything in proper order
            await initViewer();
            setupControl();
            
            console.log('ðŸš€ Ready! Drag the slider to test updateParameter function.');
        });
    </script>
</body>
</html>
